# QKD Emission Security Evaluation
This repository is a supplement to PAPER.

It contains
- Python Code (Tensorflow) to train and evaluate a Convolutional Neural Network on recorded EM-Emissions. Results are stored in JSON files.
- JSON files containing the results of evaluating the neural networks.
- Jupyter notebooks for analyzing and plotting results, which produce all figures in the paper.
- Python code to remotely control a Teledyne Lecroy WavePro 604HD Oscilloscope, which we used for our measurements
- Python code for interfacing with our QKD sender (this is not directly useful and only illustrates the measurement procedure. It can be adapted to other devices)



# How to reproduce results

## Pre-requisites

### Hardware

- PC (Windows or Linux)
- Oscilloscope (Teledyne Lecroy WavePro 604HD)
- Target of evaluation: Our home-built QKD sender electronics (by [Michael Auer](https://opg.optica.org/abstract.cfm?URI=EQEC-2021-eb_p_3))
    Adapt the interfaces to your electronics to repeat the measurements.
    Our raw measured data is available at [Zenodo](https://doi.org/10.5281/zenodo.7956055).
- Magnetic near-field probe
- RF Amplifier (e.g. Texas Instruments TRF37C73) for the probe and Power supply to power amplifier
- Cables (Ethernet for PC to osci, USB to USB-C for connecting Alice board to PC, BNC/SMA for connecting probe to oscilloscope, power cables for everything)

### Software

- Python (v3.10) and standard libraries (see `requirements.txt`)
- Tensorflow 2 installation with GPU support, if you want to train the neural network.
    The neural network takes only a few minutes to train (on GPU) so we do not include the trained network weights.
- The hyperparameter optimization needs an additional library [keras_tuner](https://www.tensorflow.org/tutorials/keras/keras_tuner).
- For interfacing with Oscilloscope, additional Python libraries (pyvisa)


## Data evaluation

The measurement procedure is explained in the paper.
This section details how to evaluate the data and reproduce result files, as well as plots.
The python files contain the neural network, function to load the data from disk and store results. Note that the `.npy` files are cached versions of the raw data that are faster to load. These are automatically generated by, e.g., the `TEMPEST_ATTACK_*` notebooks. 

The Jupyter notebooks perform the following analysis:
- `TEMPEST_ATTACK.ipynb` trains and evaluates the neural network.
- `TEMPEST_ATTACK_VARY_TRAINING_DATA.ipynb` trains and evaluates the neural network with different amounts of training data. This is only applied to the datasets that have 30 measurements.
- `TEMPEST_ATTACK_MOST_CERTAIN_SELECTION.ipynb` trains and evaluates the neural network under the assumption that the attacker can pre-select the symbols and restrict to some fraction where the neural network's predictions are most confident. This slightly increases performance and is discussed in the appendix of the paper.
- `get_raw_data_RMS_amplitude.ipynb` analyzes the raw amplitude of emissions. It is used to analyze the distance measurements.
- `hyperparameter_optimization.ipynb` performs the hyperparameter optimization for both versions of the electronics. This is used on the datasets containing 30 measurements.
- `Comparing_KeyNokey_Measurements.ipynb` analyzes the data collected with the log-periodic dipole antenna at a larger distance. It shows that we can detect whether the device is currently sending a key given the spectrum of the emissions.
- All notebooks called `Visualize_*.ipynb` input JSON files containing results and produce plots. Some of these notebooks also directly access the raw data to perform low-level analysis. In particular,
  - `Visualize_Results_Rotation.ipynb` visualizes effect of rotating probe orientation. This is not mentioned in the paper because the result is not very interesting. Apart from the rotation measurements, the orientation of the probe is always kept fixed.
  - `Visualize_single_spectrum.ipynb` Analyzes the spectra collected using the near-field probe and compare signal to the noisy background of the room where the measurement was performed.
  - `Visualize_trace_analysis.ipynb` creates a plot of (synchronized) raw measured traces and illustrates the dependence on the symbol sequence. This is useful to get intuition about the data but is not required for the further, quantitative analysis performed using neural networks.

